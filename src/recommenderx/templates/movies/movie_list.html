{% extends 'base.html' %}

{% block title %}Movies | {{ block.super }}{% endblock %}

{% block content %}
<h1>Movies</h1>

<div class="row mb-4">
    <div class="col-md-6">
        <form method="get" action="/movies/" class="d-flex">
            <input type="text" name="q" class="form-control me-2" placeholder="Search movies..." value="{{ request.GET.q }}">
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
    </div>
    <div class="col-md-6">
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="genreDropdown" data-bs-toggle="dropdown">
                Filter by Genre
            </button>
            <ul class="dropdown-menu" aria-labelledby="genreDropdown">
                <li><a class="dropdown-item" href="/movies/">All Genres</a></li>
                {% for genre in genres %}
                <li><a class="dropdown-item" href="/movies/?genre={{ genre }}">{{ genre }}</a></li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<div class="row">
    {% for movie in movies %}
    <div class="col-md-4 mb-4">
        <div class="card movie-card">
            <img src="{{ movie.poster_url }}" class="card-img-top movie-poster" alt="{{ movie.title }}">
            <div class="card-body">
                <h5 class="card-title">{{ movie.title }}</h5>
                <p class="card-text"><strong>Genre:</strong> {{ movie.genre }}</p>
                <p class="card-text">{{ movie.description|truncatechars:100 }}</p>
                <a href="/movies/{{ movie.id }}/" class="btn btn-primary">View Details</a>
                <form method="post" action="/watchlist/add/" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="movie_id" value="{{ movie.id }}">
                    <button type="submit" class="btn btn-outline-secondary">Add to Watchlist</button>
                </form>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <p>No movies found.</p>
    </div>
    {% endfor %}
</div>
{% endblock %}